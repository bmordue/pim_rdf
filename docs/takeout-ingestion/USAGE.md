# Google Takeout Ingestion for PIM RDF

This document describes how to use the Google Takeout ingestion feature to import personal data from Google services into your PIM RDF store.

## Overview

The `util/ingest_takeout.py` script can parse a Google Takeout archive and convert the data into RDF format suitable for inclusion in the PIM RDF store. It currently supports three core data types:

- **Contacts** (vCard format) → `foaf:Person` entities
- **Calendar Events** (iCalendar format) → `ical:Vevent` entities
- **Location History** (JSON format) → `pim:Place` entities

## Usage

### Basic Usage

```bash
# Ingest a Google Takeout archive
python3 util/ingest_takeout.py /path/to/takeout-archive.zip

# Dry run to see what would be processed
python3 util/ingest_takeout.py --dry-run /path/to/takeout-archive.zip

# Specify custom output directory
python3 util/ingest_takeout.py --output-dir /custom/path /path/to/takeout-archive.zip
```

### Step-by-Step Guide

1. **Download your Google Takeout archive**
   - Go to [Google Takeout](https://takeout.google.com/)
   - Select the services you want to export (Contacts, Calendar, Maps/Location History)
   - Download the ZIP archive

2. **Run the ingestion script**
   ```bash
   python3 util/ingest_takeout.py takeout-20250829-123456.zip
   ```

3. **Review the generated files**
   The script will create TTL files in the `data/` directory:
   - `data/contacts-takeout.ttl` - Imported contacts
   - `data/events-takeout.ttl` - Imported calendar events  
   - `data/locations-takeout.ttl` - Imported location history

4. **Validate the results**
   ```bash
   # Validate TTL syntax
   python3 -c "import rdflib; g=rdflib.Graph(); g.parse('data/contacts-takeout.ttl', format='turtle'); print(f'Valid: {len(g)} triples')"
   
   # Run full validation (when available)
   util/validate_pim.sh
   ```

## Generated RDF Structure

### Contacts
```turtle
:contact-takeout-001 a foaf:Person ;
    rdfs:label "John Smith" ;
    foaf:mbox <mailto:john.smith@example.com> ;
    dcterms:created "2025-08-29T20:32:16.923211"^^xsd:dateTime ;
    dcterms:source "Google Takeout - Contacts" .
```

### Calendar Events
```turtle
:event-takeout-001 a ical:Vevent ;
    dcterms:title "Team Meeting" ;
    ical:dtstart "2025-09-15T10:00:00+00:00"^^xsd:dateTime ;
    ical:location "Conference Room A" ;
    dcterms:created "2025-08-29T20:32:16.925110"^^xsd:dateTime ;
    dcterms:source "Google Takeout - Calendar" .
```

### Location History
```turtle
:place-takeout-001 a pim:Place ;
    pim:locationName "London Eye" ;
    geo:lat "51.48749"^^xsd:float ;
    geo:long "-0.0114161"^^xsd:float ;
    pim:visitedOn "2022-01-01T00:00:00+00:00"^^xsd:dateTime ;
    dcterms:created "2025-08-29T20:32:16.926338"^^xsd:dateTime ;
    dcterms:source "Google Takeout - Location History" .
```

## Configuration

The generated TTL files are automatically included in the PIM RDF workflow via `config/domains.yaml`. The following entries are added:

```yaml
# Google Takeout ingested data (generated by util/ingest_takeout.py)
- filename: "data/contacts-takeout.ttl"
  description: "Contacts imported from Google Takeout"
  required: false

- filename: "data/events-takeout.ttl"
  description: "Calendar events imported from Google Takeout"
  required: false

- filename: "data/locations-takeout.ttl"
  description: "Location history imported from Google Takeout"
  required: false
```

## Namespaces Used

The ingestion script uses standard vocabularies and the existing PIM namespace:

- `foaf:` - Friend of a Friend (contacts)
- `ical:` - iCalendar (calendar events)
- `geo:` - WGS84 Geo Positioning (location coordinates)
- `pim:` - Custom PIM namespace (https://ben.example/ns/pim#)
- `dcterms:` - Dublin Core Terms (metadata)

## Limitations and Future Enhancements

### Current Limitations
- Simple parsing of vCard and iCalendar formats (basic properties only)
- Location history limited to first 10 entries per file
- No support for Gmail, Drive, Photos, or other Google services yet

### Planned Enhancements
- Extended vCard parsing (phone numbers, addresses, organizations)
- Full iCalendar support (recurring events, attendees, reminders)
- Gmail message ingestion
- Google Drive document metadata
- Google Photos metadata
- Chrome bookmarks and browsing history

## Troubleshooting

### Common Issues

**"Archive file not found"**
- Verify the path to your Google Takeout ZIP file
- Ensure the file has read permissions

**"Invalid ZIP file"**
- Re-download your Google Takeout archive
- Check that the file downloaded completely

**"No data files found"**
- Verify your Google Takeout archive includes the expected services (Contacts, Calendar, Maps)
- Check that the service data was actually exported (some services may be empty)

**TTL Validation Errors**
- Review the generated TTL files for any formatting issues
- Check that all required namespaces are properly defined

### Debug Mode
Run with Python's verbose output to see detailed processing:
```bash
python3 -v util/ingest_takeout.py /path/to/takeout.zip
```

## Integration with Existing Workflow

The ingested data integrates seamlessly with the existing PIM RDF workflow:

1. **Data merging**: Files are included in `build/merged.ttl` via `config/domains.yaml`
2. **SPARQL queries**: Use the same queries to find contacts, events, and locations
3. **Validation**: Standard TTL syntax validation applies
4. **Tagging**: Add `:hasTag` properties to link imported data with existing tags

### Example Queries

Find all imported contacts:
```sparql
SELECT ?contact ?name ?email WHERE {
    ?contact a foaf:Person ;
             rdfs:label ?name ;
             dcterms:source "Google Takeout - Contacts" ;
             foaf:mbox ?email .
}
```

Find events in a date range:
```sparql
SELECT ?event ?title ?start ?location WHERE {
    ?event a ical:Vevent ;
           dcterms:title ?title ;
           ical:dtstart ?start ;
           ical:location ?location .
    FILTER (?start >= "2025-09-01T00:00:00Z"^^xsd:dateTime && 
            ?start < "2025-10-01T00:00:00Z"^^xsd:dateTime)
}
```

Find visited places:
```sparql
SELECT ?place ?name ?lat ?lng ?visited WHERE {
    ?place a pim:Place ;
           pim:locationName ?name ;
           geo:lat ?lat ;
           geo:long ?lng ;
           pim:visitedOn ?visited .
    ORDER BY DESC(?visited)
}
```